!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./client/src/js/tinymce_plugin.js")}({"./client/src/js/tinymce_plugin.js":function(e,t,n){"use strict";(function(e){function t(e){return e&&e.__esModule?e:{default:e}}var r=n(1),o=t(r),i=n(0),a=n(2),c=t(a),d=(0,i.loadComponent)("FormBuilderModal"),s="privacy-embed__dialog-wrapper";!function(){window.tinymce&&window.tinymce.PluginManager.add("privacyembed",function(t){t.addButton("privacyembed",{classes:"privacyembed",tooltip:"Embed privacy-aware iframes",stateSelector:"img.privacyembed-placeholder",cmd:"privacyembed"}),t.on("beforeSetContent",function(t){for(var n=t.content,r=c.default.match("privacy_embed",!1,n);r;){var o="admin/privacyembed/thumbnailsrc?id="+(r.properties.backgroundimage?r.properties.backgroundimage:""),i=e("<img/>").attr("class","privacyembed-placeholder mceItem mceNonEditable").attr("src",o).attr("data-shortcode",r.original);n=n.replace(r.original,e("<div/>").append(i).html()),r=c.default.match("privacy_embed",!1,n)}t.content=n}),t.on("postProcess",function(t){var n=e("<div>"+t.content+"</div>");n.find(".privacyembed-placeholder").each(function(){var t=e(this);t.replaceWith(t.attr("data-shortcode"))}),t.content=n.html()}),t.addCommand("privacyembed",function(){e("#"+t.id).entwine("ss").openPrivacyEmbedDialog()})})}(),e.entwine("ss",function(e){e("textarea.htmleditor").entwine({openPrivacyEmbedDialog:function(){var t=e("#"+s);t.length||(t=e('<div id="'+s+'" />'),e("body").append(t)),t.addClass("privacy-embed__dialog-wrapper"),t.setElement(this),t.open()}}),e(".js-injector-boot #"+s).entwine({Element:null,Data:{},onunmatch:function(){this._clearModal()},_clearModal:function(){o.default.unmountComponentAtNode(this[0])},open:function(){this._renderModal(!0)},close:function(){this.setData({}),this._renderModal(!1)},_handleInsert:function(t){var n=this.getElement().getEditor(),r=(e(n.getSelectedNode()),e("<div />").html(t.iframe).find("> iframe")[0]);if(!r||"IFRAME"!==r.nodeName)return this.close(),Promise.reject(Promise.reject("wrong iframe src"));r.src&&(r.dataset.privacyEmbedSrc=r.src,r.removeAttribute("src"));var o=void 0;t.backgroundimage&&t.backgroundimage.Files&&(o=t.backgroundimage.Files[0]);var i=c.default.serialise({name:"privacy_embed",properties:{iframe:encodeURIComponent(r.outerHTML),backgroundimage:o,content:encodeURIComponent(t.content?t.content:""),buttontext:t.buttontext}},!1);return tinymce.editors[0].selection.setContent(i),this.close(),Promise.resolve()},getCurrentShortcode:function(){var t=this.getElement().getEditor(),n=e(t.getSelectedNode());return n&&n.length&&n[0]&&n[0].classList.contains("privacyembed-placeholder")?c.default.match("privacy_embed",!1,n[0].dataset.shortcode):null},_renderModal:function(e){var t=this,n=function(){return t.close()},r=function(e){return t._handleInsert(e)},i=this.getCurrentShortcode(),a="/admin/privacyembed/schema";i&&(a+="?"+Object.keys(i.properties).map(function(e){return e+"="+i.properties[e]}).join("&")),o.default.render(React.createElement(d,{title:"Privacy Embed",isOpen:e,onClosed:n,onSubmit:r,schemaUrl:a,bodyClassName:"modal__dialog",className:"privacy-embed-modal",responseClassBad:"modal__response modal__response--error",responseClassGood:"modal__response modal__response--good",identifier:"PrivacyEmbed.IFRAME"}),this[0])}})})}).call(t,n(3))},0:function(e,t){e.exports=Injector},1:function(e,t){e.exports=ReactDom},2:function(e,t){e.exports=ShortcodeSerialiser},3:function(e,t){e.exports=jQuery}});