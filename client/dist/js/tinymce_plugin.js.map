{"version":3,"sources":["webpack:///webpack/bootstrap 23cb350cbde135fc79da","webpack:///./client/src/js/tinymce_plugin.js","webpack:///external \"Injector\"","webpack:///external \"ReactDom\"","webpack:///external \"ShortcodeSerialiser\"","webpack:///external \"jQuery\""],"names":["FormBuilderModal","modalId","window","tinymce","PluginManager","add","editor","addButton","classes","tooltip","stateSelector","cmd","on","e","content","match","ShortcodeSerialiser","src","properties","backgroundimage","el","jQuery","attr","original","replace","append","html","wrappedContent","find","each","replaceWith","addCommand","id","entwine","openPrivacyEmbedDialog","$","dialog","length","addClass","setElement","open","Element","Data","onunmatch","_clearModal","ReactDOM","unmountComponentAtNode","_renderModal","close","setData","_handleInsert","data","getElement","getEditor","$node","getSelectedNode","iframe","nodeName","Promise","reject","dataset","privacyEmbedSrc","removeAttribute","undefined","shortcode","serialise","name","encodeURIComponent","outerHTML","buttontext","selection","get","setContent","resolve","getCurrentShortcode","node","classList","contains","isOpen","handleHide","handleInsert","currentShortcode","schemaUrl","params","Object","keys","map","key","join","render"],"mappings":"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","file":"js/tinymce_plugin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./client/src/js/tinymce_plugin.js\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 23cb350cbde135fc79da","import ReactDOM from 'react-dom';\nimport { loadComponent } from 'lib/Injector';\nimport ShortcodeSerialiser from 'lib/ShortcodeSerialiser';\n\nconst FormBuilderModal = loadComponent('FormBuilderModal');\nconst modalId = 'privacy-embed__dialog-wrapper';\n\n(function () {\n    if (window.tinymce) {\n        window.tinymce.PluginManager.add('privacyembed', function (editor) {\n            editor.addButton('privacyembed', {\n                classes: 'privacyembed',\n                tooltip: 'Embed privacy-aware iframes',\n                stateSelector: 'img.privacyembed-placeholder',\n                cmd: 'privacyembed'\n            })\n\n            editor.on('beforeSetContent', function(e) {\n                let content = e.content;\n                let match = ShortcodeSerialiser.match('privacy_embed', false, content);\n                while(match) {\n                    const src = 'admin/privacyembed/thumbnailsrc?id=' + (match.properties.backgroundimage ? match.properties.backgroundimage : '');\n                    const el = jQuery('<img/>')\n                        .attr('class', 'privacyembed-placeholder mceItem mceNonEditable')\n                        .attr('src', src)\n                        .attr('data-shortcode', match.original);\n\n                    content = content.replace(match.original, (jQuery('<div/>').append(el).html()))\n                    match = ShortcodeSerialiser.match('privacy_embed', false, content);\n                }\n\n                e.content = content;\n            });\n\n            editor.on('postProcess', function(e) {\n                var wrappedContent = jQuery('<div>' + e.content + '</div>');\n                wrappedContent.find('.privacyembed-placeholder').each(function () {\n                    var el = jQuery(this);\n                    el.replaceWith(el.attr('data-shortcode'));\n                });\n                e.content = wrappedContent.html();\n            });\n\n            editor.addCommand('privacyembed', function () {\n                jQuery(`#${editor.id}`).entwine('ss').openPrivacyEmbedDialog();\n            });\n        });\n    }\n})();\n\njQuery.entwine('ss', ($) => {\n    $('textarea.htmleditor').entwine({\n        openPrivacyEmbedDialog() {\n            let dialog = $(`#${modalId}`);\n\n            if (!dialog.length) {\n                dialog = $(`<div id=\"${modalId}\" />`);\n                $('body').append(dialog);\n            }\n            dialog.addClass('privacy-embed__dialog-wrapper');\n\n            dialog.setElement(this);\n            dialog.open();\n        }\n    });\n\n    $(`.js-injector-boot #${modalId}`).entwine({\n        Element: null,\n        Data: {},\n\n        onunmatch() {\n            this._clearModal();\n        },\n\n        _clearModal() {\n            ReactDOM.unmountComponentAtNode(this[0]);\n        },\n\n        open() {\n            this._renderModal(true);\n        },\n\n        close() {\n            this.setData({});\n            this._renderModal(false);\n        },\n\n        _handleInsert(data) {\n            const editor = this.getElement().getEditor();\n            const $node = $(editor.getSelectedNode());\n\n            const iframe = $('<div />').html(data.iframe).find('> iframe')[0];\n            if(!iframe|| iframe.nodeName !== 'IFRAME') {\n                this.close();\n                return Promise.reject(Promise.reject('wrong iframe src'));\n            }\n\n            if(iframe.src) {\n                iframe.dataset.privacyEmbedSrc = iframe.src;\n                iframe.removeAttribute('src');\n            }\n\n            let backgroundimage = undefined;\n            if(data.backgroundimage && data.backgroundimage['Files']) {\n                backgroundimage = data.backgroundimage['Files'][0]\n            }\n\n            const shortcode = ShortcodeSerialiser.serialise({\n                name: 'privacy_embed',\n                properties: {\n                    iframe: encodeURIComponent(iframe.outerHTML),\n                    backgroundimage: backgroundimage,\n                    content: encodeURIComponent(data.content ? data.content : ''),\n                    buttontext: data.buttontext\n                }\n            }, false);\n\n            //console.log(this.getElement()[0].id);\n            //console.log(tinymce.editors);\n\n            const selection = tinymce.get(this.getElement()[0].id).selection.setContent(shortcode);\n            this.close();\n\n            return Promise.resolve();\n        },\n\n        getCurrentShortcode() {\n            const editor = this.getElement().getEditor();\n            const node = $(editor.getSelectedNode());\n\n            if(!node || !node.length || !node[0] || !node[0].classList.contains('privacyembed-placeholder')) {\n                return null;\n            }\n\n            return ShortcodeSerialiser.match('privacy_embed', false, node[0].dataset.shortcode);\n        },\n\n        _renderModal(isOpen) {\n            const handleHide = () => this.close();\n            const handleInsert = (data) => this._handleInsert(data);\n            const currentShortcode = this.getCurrentShortcode();\n            let schemaUrl = '/admin/privacyembed/schema';\n            if(currentShortcode) {\n                let params = Object.keys(currentShortcode.properties)\n                .map(key => `${key}=${currentShortcode.properties[key]}`)\n                .join('&');\n                schemaUrl += '?' + params;\n            }\n\n            // create/update the react component\n            ReactDOM.render(\n                <FormBuilderModal\n                    title=\"Privacy Embed\"\n                    isOpen={isOpen}\n                    onClosed={handleHide}\n                    onSubmit={handleInsert}\n                    schemaUrl={schemaUrl}\n                    bodyClassName=\"modal__dialog\"\n                    className=\"privacy-embed-modal\"\n                    responseClassBad=\"modal__response modal__response--error\"\n                    responseClassGood=\"modal__response modal__response--good\"\n                    identifier=\"PrivacyEmbed.IFRAME\"\n                />,\n                this[0]\n            );\n        },\n    });\n});\n\n\n// WEBPACK FOOTER //\n// ./client/src/js/tinymce_plugin.js","module.exports = Injector;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Injector\"\n// module id = 0\n// module chunks = 0","module.exports = ReactDom;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDom\"\n// module id = 1\n// module chunks = 0","module.exports = ShortcodeSerialiser;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ShortcodeSerialiser\"\n// module id = 2\n// module chunks = 0","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}