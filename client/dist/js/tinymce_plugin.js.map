{"version":3,"sources":["webpack:///webpack/bootstrap 72d5e5fc3da22e68bac9","webpack:///./client/src/js/tinymce_plugin.js","webpack:///external \"jQuery\"","webpack:///external \"Injector\"","webpack:///external \"ReactDom\"","webpack:///external \"ShortcodeSerialiser\""],"names":["FormBuilderModal","modalId","window","tinymce","PluginManager","add","editor","addButton","classes","tooltip","stateSelector","cmd","on","e","content","match","ShortcodeSerialiser","iframe","properties","src","el","jQuery","attr","replace","original","append","html","wrappedContent","find","each","replaceWith","trim","addCommand","id","entwine","openPrivacyEmbedDialog","$","dialog","length","addClass","setElement","open","Element","Data","onunmatch","_clearModal","ReactDOM","unmountComponentAtNode","_renderModal","close","setData","_handleInsert","data","getElement","getEditor","$node","getSelectedNode","nodeName","Promise","reject","dataset","privacyEmbedSrc","removeAttribute","shortcode","serialise","name","encodeURIComponent","outerHTML","selection","activeEditor","setContent","resolve","getCurrentIframe","node","classList","contains","isOpen","handleHide","handleInsert","currentIframe","schemaUrl","render"],"mappings":"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","file":"js/tinymce_plugin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./client/src/js/tinymce_plugin.js\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 72d5e5fc3da22e68bac9","import ReactDOM from 'react-dom';\r\nimport { loadComponent } from 'lib/Injector';\r\nimport ShortcodeSerialiser, { sanitiseShortCodeProperties } from 'lib/ShortcodeSerialiser';\r\n\r\nconst FormBuilderModal = loadComponent('FormBuilderModal');\r\nconst modalId = 'privacy-embed__dialog-wrapper';\r\n\r\n(function () {\r\n    if (window.tinymce) {\r\n        window.tinymce.PluginManager.add('privacyembed', function (editor) {\r\n            editor.addButton('privacyembed', {\r\n                classes: 'privacyembed',\r\n                tooltip: 'Embed privacy-aware iframes',\r\n                stateSelector: 'img.privacyembed-placeholder',\r\n                cmd: 'privacyembed'\r\n            })\r\n\r\n            editor.on('beforeSetContent', function(e) {\r\n                let content = e.content;\r\n                let match = ShortcodeSerialiser.match('privacy_embed', false, content);\r\n                while(match) {\r\n                    const iframe = match.properties.iframe;\r\n                    const src = 'admin/privacyembed/thumbnailsrc';\r\n                    const el = jQuery('<img/>')\r\n                        .attr('class', 'privacyembed-placeholder mceItem mceNonEditable')\r\n                        .attr('src', src)\r\n                        .attr('data-shortcode', iframe);\r\n\r\n                    content = content.replace(match.original, (jQuery('<div/>').append(el).html()))\r\n                    match = ShortcodeSerialiser.match('privacy_embed', false, content);\r\n                }\r\n\r\n                e.content = content;\r\n            });\r\n\r\n            editor.on('postProcess', function(e) {\r\n                var wrappedContent = jQuery('<div>' + e.content + '</div>');\r\n                wrappedContent.find('.privacyembed-placeholder').each(function () {\r\n                    var el = jQuery(this);\r\n                    el.replaceWith('[privacy_embed iframe=\"' + tinymce.trim(el.attr('data-shortcode')) + '\"]');\r\n                });\r\n                e.content = wrappedContent.html();\r\n            });\r\n\r\n            editor.addCommand('privacyembed', function () {\r\n                jQuery(`#${editor.id}`).entwine('ss').openPrivacyEmbedDialog();\r\n            });\r\n        });\r\n    }\r\n})();\r\n\r\njQuery.entwine('ss', ($) => {\r\n    $('textarea.htmleditor').entwine({\r\n        openPrivacyEmbedDialog() {\r\n            let dialog = $(`#${modalId}`);\r\n\r\n            if (!dialog.length) {\r\n                dialog = $(`<div id=\"${modalId}\" />`);\r\n                $('body').append(dialog);\r\n            }\r\n            dialog.addClass('privacy-embed__dialog-wrapper');\r\n\r\n            dialog.setElement(this);\r\n            dialog.open();\r\n        }\r\n    });\r\n\r\n    $(`.js-injector-boot #${modalId}`).entwine({\r\n        Element: null,\r\n        Data: {},\r\n\r\n        onunmatch() {\r\n            this._clearModal();\r\n        },\r\n\r\n        _clearModal() {\r\n            ReactDOM.unmountComponentAtNode(this[0]);\r\n        },\r\n\r\n        open() {\r\n            this._renderModal(true);\r\n        },\r\n\r\n        close() {\r\n            this.setData({});\r\n            this._renderModal(false);\r\n        },\r\n\r\n        _handleInsert(data) {\r\n            const editor = this.getElement().getEditor();\r\n            const $node = $(editor.getSelectedNode());\r\n\r\n            const iframe = $('<div />').html(data.iframe).find('> iframe')[0];\r\n            if(!iframe|| iframe.nodeName !== 'IFRAME') {\r\n                this.close();\r\n                return Promise.reject(Promise.reject('wrong iframe src'));\r\n            }\r\n\r\n            if(iframe.src) {\r\n                iframe.dataset.privacyEmbedSrc = iframe.src;\r\n                iframe.removeAttribute('src');\r\n            }\r\n\r\n            const shortcode = ShortcodeSerialiser.serialise({\r\n                name: 'privacy_embed',\r\n                properties: { iframe: encodeURIComponent(iframe.outerHTML) },\r\n            }, false);\r\n\r\n            const selection = tinymce.activeEditor.selection.setContent(shortcode);\r\n            this.close();\r\n\r\n            return Promise.resolve();\r\n        },\r\n\r\n        getCurrentIframe() {\r\n            const editor = this.getElement().getEditor();\r\n            const node = $(editor.getSelectedNode());\r\n\r\n            if(!node || !node.length || !node[0] || !node[0].classList.contains('privacyembed-placeholder')) {\r\n                return null;\r\n            }\r\n\r\n            return node[0].dataset.shortcode;\r\n        },\r\n\r\n        _renderModal(isOpen) {\r\n            const handleHide = () => this.close();\r\n            const handleInsert = (data) => this._handleInsert(data);\r\n            const currentIframe = this.getCurrentIframe();\r\n            let schemaUrl = '/admin/privacyembed/schema';\r\n            if(currentIframe) {\r\n                schemaUrl += '?iframe=' + currentIframe;\r\n            }\r\n\r\n            // create/update the react component\r\n            ReactDOM.render(\r\n                <FormBuilderModal\r\n                    title=\"Privacy Embed\"\r\n                    isOpen={isOpen}\r\n                    onClosed={handleHide}\r\n                    onSubmit={handleInsert}\r\n                    schemaUrl={schemaUrl}\r\n                    bodyClassName=\"modal__dialog\"\r\n                    className=\"privacy-embed-modal\"\r\n                    responseClassBad=\"modal__response modal__response--error\"\r\n                    responseClassGood=\"modal__response modal__response--good\"\r\n                    identifier=\"PrivacyEmbed.IFRAME\"\r\n                />,\r\n                this[0]\r\n            );\r\n        },\r\n    });\r\n});\n\n\n// WEBPACK FOOTER //\n// ./client/src/js/tinymce_plugin.js","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 0","module.exports = Injector;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Injector\"\n// module id = 1\n// module chunks = 0","module.exports = ReactDom;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDom\"\n// module id = 2\n// module chunks = 0","module.exports = ShortcodeSerialiser;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ShortcodeSerialiser\"\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}